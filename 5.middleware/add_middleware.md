# добавление собственного класса

Код примера находится в файле `logger.py`

Полученный middleware отслеживает в приложении время выполнения каждого запроса, записывает это в лог и добавляет заголовок "X-Elapsed-Time" со значением времени выполнения запроса в HTTP-ответ.

В рассмотренном примере были выполнены следующие шаги:

- Создание модуля middleware.
В вашем Django-приложении создайте модуль с названием `middleware`.

- Определение класса middleware.
Объявите в модуле простой класс. Этому классу не нужно наследоваться от какого-либо другого класса.
- Метод `__init__`.
В классе определите метод `__init__`, который принимает функцию `get_response`. Сохраните функцию `get_response` на экземпляре класса.
- Метод `__call__`.
Определите метод `__call__` в вашем классе. Этот метод будет вызван Django, когда настанет очередь вашего middleware. Перед вызовом `get_response`, выполните необходимую подготовку к обработке запроса. Например, вы можете засечь время начала обработки запроса.
- Обработка и возвращение ответа.
После вызова `get_response`, обработайте полученный ответ. Здесь можно измерить общее время выполнения запроса. Вы можете модифицировать ответ, добавляя в него время выполнения запроса.
- Логирование информации.
Рассмотрите возможность логирования времени выполнения запроса или другой соответствующей информации.

> Эти шаги помогут вам разработать собственный middleware в Django, обеспечивая гибкость и точный контроль над процессом обработки запросов и ответов в вашем приложении.

После создания вашего промежуточного ПО, нужно установить его в настройки приложения. Для этого в файле settings.py добавьте путь до вашего middleware-компонента в список MIDDLEWARE. Разместите его в начале списка, чтобы измерить время выполнения всего запроса, включая последующие middleware:

![Alt text](https://prof.learning.samolet.ru/data/scorms/ffcbb5b4-e2a0-48a5-bdd2-835ce674202b/res/data/islru-249352/c8230c2c-9e35-11ee-a6e8-fab1bec65fa7.png)

Запустите сервер командой: `python manage.py runserver`

Затем посетите любую страницу.

После этого в терминале будет видно время обработки запроса. Также оно будет показано в инструментах разработчика на вкладке Network в заголовке ответа X-Elapsed-Time.

## end

В middleware Django основные этапы включают:

- Первый этап, который происходит до обработки запроса функцией представления. Здесь middleware может выполнить такие действия, как модификация запроса или аутентификация пользователя.

- Второй этап начинается после того, как функция представления обработала запрос и сформировала ответ. На этом этапе middleware может модифицировать ответ перед его отправкой клиенту, добавляя заголовки или выполняя логирование.

Эти два этапа подчеркивают ключевую роль middleware в обработке запросов и ответов в Django, позволяя управлять и модифицировать их.